<div class="modal-content">
	<div class="modal-header">
		<a class="close" data-dismiss="modal">×</a>
		<h3>Importation de contacts validation </h3>
	</div>
	<div class="modal-body">
{% set indexes = form.children %}
<style>
table.table.table-striped td{ width: 32%}
</style>
	<div class="modal-body">
	{{ form_start(form,  { 'action': path('crm_importer_validation'), 'attr': {'data-async': '', 'data-target' : '#modal' } }) }}
	{{ form_errors(form) }}
	<div class="row">
		<div class="col-md-12">
			<p>Choissez comment corriger les erreurs.</p>
		</div>

			{{ form_start(form) }}

	{% if arr_err_comptes|length > 0 %}
	<div class="row">
		<div class="col-md-12">
			<h2>Organisation{% if arr_err_comptes[0]|length > 1 %}s{% endif %} inexistante{% if arr_err_comptes[0]|length > 1 %}s{% endif %} :</h2>
		</div>
	</div>
	<div class="row">
		<div class="col-md-12">
			<table class="table table-striped">
				<tbody>
					{% for k, key1 in arr_err_comptes %}
						{% for key, err in key1 %}
							{% if indexes['comptes-' ~ k ~ '-' ~ key~'-radio'] is defined %}
							<tr>
								<td><strong> {{ err.err }} </strong></td>
								<td>
									{{ form_widget(attribute(form, 'comptes-' ~ k ~ '-' ~ key~'-radio'), {'attr' : {'class' : 'radio-compte'}}) }}
								</td>
								<td>
									<div class="typeahead-container">
										<div class="typeahead-field">
											<span class="typeahead-query">
												{{ form_label(attribute(form, 'comptes-' ~ k ~ '-' ~ key~'-name')) }}
												{{ form_widget(attribute(form, 'comptes-' ~ k ~ '-' ~ key~'-name'), {'attr' : {'class' : 'typeahead-compte input-compte-name'}}) }}
												{{ form_row(attribute(form, 'comptes-' ~ k ~ '-' ~ key~'-compte')) }}
												{{ form_row(attribute(form, 'comptes-' ~ k ~ '-' ~ key~'-label')) }}
											</span> 
										</div>
									</div>
								</td>
							</tr>
							{% endif %}
						{% endfor %}
					{% endfor %}
				</tbody>
			</table>
		</div>
	</div>
	{% endif %}

	{% if arr_err_contact|length > 0 %}
	<div class="row">
		<div class="col-md-12">
			<h2>Adresse{% if arr_err_contact[0]|length > 1 %}s{% endif %} email{% if arr_err_contact[0]|length > 1 %}s{% endif %} utilisée{% if arr_err_contact[0]|length > 1 %}s{% endif %} :</h2>
		</div>
	</div>
	<div class="row">
		<div class="col-md-12">
			<table class="table table-striped">
				<tbody>
					{% for k, key1 in arr_err_contact %}
						{% for key, err in key1 %}
							{% if indexes['contact-' ~ k ~ '-' ~ key~'-radio'] is defined %}
								<tr>
									<td><strong> {{ err.err }} </strong></td>
									<td>
										{{ form_widget(attribute(form, 'contact-' ~ k ~ '-' ~ key~'-radio'), {'attr' : {'class' : 'radio-contact'}}) }}
									</td>
									<td>
										<div class="typeahead-container">
											<div class="typeahead-field">
												<span class="typeahead-query">
													{{ form_label(attribute(form, 'contact-' ~ k ~ '-' ~ key~'-name')) }}
													{{ form_widget(attribute(form, 'contact-' ~ k ~ '-' ~ key~'-name'), {'attr' : {'class' : 'input-contact-email'}}) }}
												</span> 
											</div>
										</div>
									</td>
								</tr>
							{% endif %}
						{% endfor %}
					{% endfor %}
				</tbody>
			</table>
		</div>
	</div>
	{% endif %}

	{% if arr_err_email|length > 0 %}
	<div class="row">
		<div class="col-md-12">
			<h2>Adresse{% if arr_err_email[0]|length > 1 %}s{% endif %} email{% if arr_err_email[0]|length > 1 %}s{% endif %} incorrecte{% if arr_err_email[0]|length > 1 %}s{% endif %} :</h2>
		</div>
	</div>
	<div class="row">
		<div class="col-md-12">
			<table class="table table-striped">
				<tbody>
					{% for k, key1 in arr_err_email %}
						{% for key, err in key1 %}
							{% if indexes['email-' ~ k ~ '-' ~ key~'-radio'] is defined %}
								<tr>
									<td><strong> {{ err.err }} </strong></td>
									<td>
										{{ form_widget(attribute(form, 'email-' ~ k ~ '-' ~ key~'-radio'), {'attr' : {'class' : 'radio-email'}}) }}
									</td>
									<td>
										<div class="typeahead-container">
											<div class="typeahead-field">
												<span class="typeahead-query">
													{{ form_label(attribute(form, 'email-' ~ k ~ '-' ~ key~'-name')) }}
													{{ form_widget(attribute(form, 'email-' ~ k ~ '-' ~ key~'-name')) }}
												</span>
											</div>
											<div class="typeahead-field">
												<span class="typeahead-query">
													{{ form_label(attribute(form, 'email-' ~ k ~ '-' ~ key~'-name2')) }}
													{{ form_widget(attribute(form, 'email-' ~ k ~ '-' ~ key~'-name2')) }}
												</span>
											</div>
										</div>
									</td>
								</tr>
							{% endif %}
						{% endfor %}
					{% endfor %}
				</tbody>
			</table>
		</div>
	</div>
	{% endif %}

	{% if arr_err_reseaux|length > 0 %}
	<div class="row">
		<div class="col-md-12">
			<h2>Réseau{% if arr_err_reseaux[0]|length > 1 %}x{% endif %} inexistant{% if arr_err_reseaux[0]|length > 1 %}s{% endif %} :</h2>
		</div>
	</div>
	<div class="row">
		<div class="col-md-12">
			<table class="table table-striped">
				<tbody>
					{% for k, key1 in arr_err_reseaux %}
						{% for key, err in key1 %}
							{% if indexes['reseaux-' ~ k ~ '-' ~ key~'-radio'] is defined %}
								<tr>
									<td><strong> {{ err.err }} </strong></td>
									<td>
										{{ form_widget(attribute(form, 'reseaux-' ~ k ~ '-' ~ key~'-radio'), {'attr' : {'class' : 'radio-reseau'}}) }}
									</td>
									<td>
										<div class="typeahead-container">
											<div class="typeahead-field">
												<span class="typeahead-query">
													{{ form_label(attribute(form, 'reseaux-' ~ k ~ '-' ~ key~'-name')) }}
													{{ form_widget(attribute(form, 'reseaux-' ~ k ~ '-' ~ key~'-name')) }}
												</span> 
											</div>
										</div>
									</td>
								</tr>
							{% endif %}
						{% endfor %}
					{% endfor %}
				</tbody>
			</table>
		</div>
	</div>
	{% endif %}

	{% if arr_err_origine|length > 0 %}
		<div class="row">
			<div class="col-md-12">
				<h2>Origine{% if arr_err_origine[0]|length > 1 %}x{% endif %} inexistante{% if arr_err_origine[0]|length > 1 %}s{% endif %} :</h2>
			</div>
		</div>
		<div class="row">
			<div class="col-md-12">
				<table class="table table-striped">
					<tbody>
					{% for k, key1 in arr_err_origine %}
						{% for key, err in key1 %}
							{% if indexes['origine-' ~ k ~ '-' ~ key~'-radio'] is defined %}
								<tr>
									<td><strong> {{ err.err }} </strong></td>
									<td>
										{{ form_widget(attribute(form, 'origine-' ~ k ~ '-' ~ key~'-radio'), {'attr' : {'class' : 'radio-reseau'}}) }}
									</td>
									<td>
										<div class="typeahead-container">
											<div class="typeahead-field">
											<span class="typeahead-query">
												{{ form_label(attribute(form, 'origine-' ~ k ~ '-' ~ key~'-name')) }}
												{{ form_widget(attribute(form, 'origine-' ~ k ~ '-' ~ key~'-name')) }}
											</span>
											</div>
										</div>
									</td>
								</tr>
							{% endif %}
						{% endfor %}
					{% endfor %}
					</tbody>
				</table>
			</div>
		</div>
	{% endif %}

	{% if arr_err_serviceInteret|length > 0 %}
		<div class="row">
			<div class="col-md-12">
				<h2>Service d'interêt{% if arr_err_serviceInteret[0]|length > 1 %}s{% endif %} inexistant{% if arr_err_serviceInteret[0]|length > 1 %}s{% endif %} :</h2>
			</div>
		</div>
		<div class="row">
			<div class="col-md-12">
				<table class="table table-striped">
					<tbody>
					{% for k, key1 in arr_err_serviceInteret %}
						{% for key, err in key1 %}
							{% if indexes['serviceInteret-' ~ k ~ '-' ~ key~'-radio'] is defined %}
								<tr>
									<td><strong> {{ err.err }} </strong></td>
									<td>
										{{ form_widget(attribute(form, 'serviceInteret-' ~ k ~ '-' ~ key~'-radio'), {'attr' : {'class' : 'radio-reseau'}}) }}
									</td>
									<td>
										<div class="typeahead-container">
											<div class="typeahead-field">
											<span class="typeahead-query">
												{{ form_label(attribute(form, 'serviceInteret-' ~ k ~ '-' ~ key~'-name')) }}
												{{ form_widget(attribute(form, 'serviceInteret-' ~ k ~ '-' ~ key~'-name')) }}
											</span>
											</div>
										</div>
									</td>
								</tr>
							{% endif %}
						{% endfor %}
					{% endfor %}
					</tbody>
				</table>
			</div>
		</div>
	{% endif %}
		{% if arr_err_themeInteret|length > 0 %}
			<div class="row">
				<div class="col-md-12">
					<h2>Theme d'interêt{% if arr_err_themeInteret[0]|length > 1 %}s{% endif %} inexistant{% if arr_err_themeInteret[0]|length > 1 %}s{% endif %} :</h2>
				</div>
			</div>
			<div class="row">
				<div class="col-md-12">
					<table class="table table-striped">
						<tbody>
						{% for k, key1 in arr_err_themeInteret %}
							{% for key, err in key1 %}
								{% if indexes['themeInteret-' ~ k ~ '-' ~ key~'-radio'] is defined %}
									<tr>
										<td><strong> {{ err.err }} </strong></td>
										<td>
											{{ form_widget(attribute(form, 'themeInteret-' ~ k ~ '-' ~ key~'-radio'), {'attr' : {'class' : 'radio-reseau'}}) }}
										</td>
										<td>
											<div class="typeahead-container">
												<div class="typeahead-field">
												<span class="typeahead-query">
													{{ form_label(attribute(form, 'themeInteret-' ~ k ~ '-' ~ key~'-name')) }}
													{{ form_widget(attribute(form, 'themeInteret-' ~ k ~ '-' ~ key~'-name')) }}
												</span>
												</div>
											</div>
										</td>
									</tr>
								{% endif %}
							{% endfor %}
						{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
		{% endif %}

		{% if arr_err_secteurActivite|length > 0 %}
			<div class="row">
				<div class="col-md-12">
					<h2>Secteur d'activité{% if arr_err_secteurActivite[0]|length > 1 %}s{% endif %} inexistant{% if arr_err_secteurActivite[0]|length > 1 %}s{% endif %} :</h2>
				</div>
			</div>
			<div class="row">
				<div class="col-md-12">
					<table class="table table-striped">
						<tbody>
						{% for k, key1 in arr_err_secteurActivite %}
							{% for key, err in key1 %}
								{% if indexes['secteurActivite-' ~ k ~ '-' ~ key~'-radio'] is defined %}
									<tr>
										<td><strong> {{ err.err }} </strong></td>
										<td>
											{{ form_widget(attribute(form, 'secteurActivite-' ~ k ~ '-' ~ key~'-radio'), {'attr' : {'class' : 'radio-reseau'}}) }}
										</td>
										<td>
											<div class="typeahead-container">
												<div class="typeahead-field">
												<span class="typeahead-query">
													{{ form_label(attribute(form, 'secteurActivite-' ~ k ~ '-' ~ key~'-name')) }}
													{{ form_widget(attribute(form, 'secteurActivite-' ~ k ~ '-' ~ key~'-name')) }}
												</span>
												</div>
											</div>
										</td>
									</tr>
								{% endif %}
							{% endfor %}
						{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
		{% endif %}

	<div class="row">
		<div class="col-md-12">	
			 {{ form_widget(form.submit) }} 
		</div>
	</div>
	<div class="row">
		<div class="col-md-12">	
			{{ form_errors(form) }}
			{{ form_end(form) }}
		</div>
	</div>


	</div>
</div>
	
	
	<script type="text/javascript">
	
		$(document).ready( function () {   

			{% for k, key1 in arr_err_comptes %}
				{% for key, compte in key1 %}
					{% if indexes['comptes-' ~ k ~ '-' ~ key~'-radio'] is defined %}
						var selector = "#{{ form['comptes-' ~ k ~ '-' ~ key~'-name'].vars.id }}";
						$(selector).typeahead({
							order: "desc",
							source: {
								url: "{{ path('crm_compte_get_liste') }}"
							},
							callback: {
								onInit: function (node) {
									console.log('Typeahead Initiated on ' + node.selector);
								},
								onClickAfter: function (node, a, item, event) {
									$("#{{ form['comptes-' ~ k ~ '-' ~ key~'-compte'].vars.id }}").val(item.id);
								}
							},
							debug: true
						});
						
					{% endif %}
				{% endfor %}
			{% endfor %}

			//activer ou désactiver le textinput selon l'option choisie
			$('.radio-compte input:radio').click(function(){
				console.log('compte'+$(this).val());
				if($(this).val() == "existing"){
					$(this).parents('td').next().find('input[type="text"],select').attr('disabled', false);
				} else {
					$(this).parents('td').next().find('input[type="text"],select').attr('disabled', true);
				}
			});

			$('.radio-contact input:radio').click(function(){
				console.log('contact'+$(this).val());
				if($(this).val() == "new"){
					$(this).parents('td').next().find('input[type="text"],select').attr('disabled', false);
				} else {
					$(this).parents('td').next().find('input[type="text"],select').attr('disabled', true);
				}
			});

			$('.radio-email input:radio').click(function(){
				console.log('email'+$(this).val());
				if($(this).val() == "new"){
					$(this).parents('td').next().find('input[type="text"],select').attr('disabled', false);
				}
				else if($(this).val() == "new2"){
					$(this).parents('td').next().find('input[type="text"],select').attr('disabled', false);
				}
				else {
					$(this).parents('td').next().find('input[type="text"],select').attr('disabled', true);
				}
			});

			$('.radio-reseau input:radio').click(function(){
				console.log('reseau'+$(this).val());
				if($(this).val() == "existing"){
					$(this).parents('td').next().find('select').attr('disabled', false);
				} else {
					$(this).parents('td').next().find('select').attr('disabled', true);
				}
			});

			$('input:radio:checked').each(function(){
				console.log($(this).val());
				if($(this).val() == "existing"){
					$(this).parents('td').next().find('input[type="text"],select').attr('disabled', false);
				} else {
					$(this).parents('td').next().find('input[type="text"],select').attr('disabled', true);
				}
			});

			if( $('a#linkMappingValidation').length < 1 )
				$('a#linkMapping').after('<a id="linkMappingValidation" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-icon-primary blink_me" href="{{ path('crm_importer_validation') }}" data-toggle="modal" data-target="#modal"><span class="ui-button-icon-primary ui-icon 	ui-icon-info"></span><span class="ui-button-text">Rouvrir la validation</span></a>');
		});
	</script>	
	
	
	
